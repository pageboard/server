<!DOCTYPE html>
<html>
<head>
<style type="text/css">
body {
	background-color:#EEE;
	font-family:monospace;
	color:#333;
	text-align:center;
}
pre {
	max-height:25%;
	overflow:auto;
	text-align:left;
}
.preloader {
	display: flex;
	justify-content: center;
	align-items: center;
	flex-direction:column;
	width: 100%;
	height:100%;
	position: absolute;
	top:0;
	left:0;
}
.preloader-chasing-squares {
	width: 50px;
	height: 50px;
	font-size:0;
}

.preloader-chasing-squares .square {
	display: inline-block;
	width: 40%;
	height: 40%;
	margin:5%;
	border-radius:100%;
	opacity: 0;
	background: #666;
}

.preloader-chasing-squares .square {
	animation: focusfade 2.8s infinite;
}

.preloader-chasing-squares .square:nth-child(1) {
	animation-delay: 0s;
}

.preloader-chasing-squares .square:nth-child(2) {
	animation-delay: .7s;
}

.preloader-chasing-squares .square:nth-child(3) {
	animation-delay: 2.1s;
}

.preloader-chasing-squares .square:nth-child(4) {
	animation-delay: 1.4s;
}

@keyframes focusfade {
	0% {
		opacity:0;
	}
	15% {
		opacity: 1;
	}
	100% {
		opacity: 0;
	}
}
</style>
<script>
window.statusCheck = function() {
	if (document.location.protocol == "file:") {
		console.warn("file protocol, doing nothing");
		return;
	}
	var titleNode = document.getElementById('title');
	var contentNode = document.getElementById('content');
	var xhr = new XMLHttpRequest();
	xhr.open("GET", "/.well-known/status.json", true);
	xhr.onreadystatechange = function() {
		if (this.readyState != 4) return;
		if (this.status == 200) {
			var res;
			try {
				res = JSON.parse(this.responseText);
			} catch(ex) {
				setTimeout(function() {
					window.statusCheck();
				}, 1000);
				return;
			}

			if (res.errors && res.errors.length) {
				display('Error installing site', res.errors.map(function(line) {
					var str = Object.keys(line).map(function(key) {
						var val = line[key];
						if (typeof val != "string") val = JSON.stringify(val);
						return key + ": " + "<pre>" + val + "</pre>";
					}).join('<br>');
					return '<hr><p>' + str + '</p>';
				}).join('\n'));
			} else {
				var ref = document.location.search;
				if (ref.startsWith('?')) ref = ref.substring(1);
				ref = decodeURIComponent(ref);
				if (!ref.startsWith('/') || ref.startsWith('//')) ref = '/';
				display('Redirecting to <a href="' + encodeURI(ref) + '">' + ref + '</a>', "");
				setTimeout(function() {
					document.location = ref;
				}, 500);
				return;
			}
		} else if (this.status == 404) {
			display("Site not found", "Please check the address");
		} else if (this.status == 0) {
			display("Request error", "Please contact administrator");
		} else {
			setTimeout(function() {
				window.statusCheck();
			}, 1000);
		}
	};
	try {
		xhr.send();
	} catch(ex) {
		display("Network error", "Please contact administrator");
	}

	function display(title, content) {
		titleNode.innerHTML = title;
		contentNode.innerHTML = content;
	}
};

</script>
</head>
<body onload="statusCheck()">
<h2 id="title"></h2>
<div id="content">
<div class='preloader'>
	<div class='preloader-chasing-squares'>
		<div class='square'></div>
		<div class='square'></div>
		<div class='square'></div>
		<div class='square'></div>
	</div>
	<p>please wait</p>
</div>
</div>
</body>
</html>
